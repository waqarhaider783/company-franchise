/**
* Package: wordpress-plugin-starter - v1.0.3 
* Description: A simple starter kit for building awesome WordPress plugins 
* Last build: 2016-10-18 
* @author codekraft-studio 
* @license GPL-2.0+ 
*/
!function(a){"use strict";console.info("Plugin admin script loaded.")}(jQuery);

jQuery(function($){
	// on upload button click
	$('body').on( 'click', '.misha-upl', function(e){

		e.preventDefault();

		var button = $(this),
		custom_uploader = wp.media({
			title: 'Insert image',
			library : {
				uploadedTo : wp.media.view.settings.post.id, // attach to the current post?
				type : 'image'
			},
			button: {
				text: 'Use this image' // button label text
			},
			multiple: false
		}).on('select', function() { // it also has "open" and "close" events
			var attachment = custom_uploader.state().get('selection').first().toJSON();
			button.html('<img src="' + attachment.url + '" style="width:200px;">').next().show().next().val(attachment.id);
		}).open();
	
	});
	// on remove button click
	$('body').on('click', '.misha-rmv', function(e){
		e.preventDefault();
		var button = $(this);
		button.next().val(''); // emptying the hidden field
		button.hide().prev().html('Upload image');
	});

    if(jQuery('.add_row').length > 1)
        jQuery('.add_row .remove_row_btn').show();
});

/**
 * Add Row Generic Function  
 */

jQuery(document).on('click', '.add_row_btn', function(){
	var parent = jQuery(this).closest('.add_row_main');
	var mainRow = jQuery('.add_row', parent).last();
	var mainRowHtml = jQuery('.add_row.hide', parent).html();
	mainRow.after(`<div class="add_row">${mainRowHtml}</div>`);
	var lastRow = jQuery('.add_row', parent).last();
	jQuery('select', lastRow).addClass('select2');
	jQuery('select', lastRow).select2();
	if(jQuery('.add_row', parent).length > 1)
        jQuery('.remove_row_btn', parent).removeClass('hide');
});
jQuery(document).on('click', '.remove_row_btn', function(){
	var parent = jQuery(this).closest('.add_row_main');
    if(jQuery('.add_row', parent).length > 1)
        jQuery('.add_row', parent).last().remove(); 
    if(jQuery('.add_row', parent).length == 1)
        jQuery('.remove_row_btn', parent).addClass('hide');
});

if(jQuery('.firstRibbonTr').length != 0){
	$html = `<tr class="toggleRibbon">
				<td style="padding:0"><h2>Default Side Ribbon</h2></td>
			</tr>`;
	jQuery($html).insertBefore('.firstRibbonTr');
}

jQuery(document).on('click', '.toggleRibbon', function(){
	jQuery(this).toggleClass('active');
	(jQuery(this).hasClass('active') ? jQuery('.sideRibbonField').addClass('show') : jQuery('.sideRibbonField').removeClass('show'));
});
jQuery(document).ready(function(){
	jQuery('.select2').select2();
});